use super::ExploitRule;
use crate::svg_checker::SvgCheckError;
use async_trait::async_trait;
use quick_xml::name::QName;
use quick_xml::Reader;

pub struct ForeignObjectRule;

impl ForeignObjectRule {
    pub fn new() -> Self {
        ForeignObjectRule
    }
}

#[async_trait]
impl ExploitRule for ForeignObjectRule {
    async fn check_event(
        &self,
        e: &quick_xml::events::BytesStart<'_>,
        _reader: &Reader<&[u8]>,
    ) -> Result<(), SvgCheckError> {
        if e.name() == QName(b"foreignObject") {
            return Err(SvgCheckError::ExploitDetected(
                "foreignObject tag found".to_string(),
            ));
        }
        Ok(())
    }
}
