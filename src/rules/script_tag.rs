use super::ExploitRule;
use crate::svg_checker::SvgCheckError;
use async_trait::async_trait;
use quick_xml::Reader;

pub struct ScriptTagRule;

impl ScriptTagRule {
    pub fn new() -> Self {
        ScriptTagRule
    }
}

#[async_trait]
impl ExploitRule for ScriptTagRule {
    async fn check_event(
        &self,
        e: &quick_xml::events::BytesStart<'_>,
        _reader: &Reader<&[u8]>,
    ) -> Result<(), SvgCheckError> {
        if e.name() == quick_xml::name::QName(b"script") {
            Err(SvgCheckError::ExploitDetected(
                "Script tag found".to_string(),
            ))
        } else {
            Ok(())
        }
    }
}
